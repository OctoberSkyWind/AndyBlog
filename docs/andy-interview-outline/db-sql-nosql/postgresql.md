# postgresql

[[toc]]
[toc]

## 数据类型

#### tsvector 类型

tsquery 类型

## 索引

#### PostgreSQL 中的
`函数索引（也叫表达式索引）` 是基于列的计算结果 / 函数调用结果创建的索引，而非列本身的值，解决了 “WHERE/HAVING/ORDER BY 中使用列表达式 / 函数时普通索引失效” 的问题（是！）

#### PostgreSQL索引的键除了可以是`一个函数`外，还可以是从一个或多个字段计算出来的`标量表达式`（是！）

#### PG
`函数索引适用`引常见场景：如 1.字段格式化、转换后的查询；2.复合表达式计算后的查询；3.空值 / 非空值的精准过滤;枚举值 / 状态的衍生计算;4.空间数据 / JSON 字段的提取查询等等（是！）

#### PG
`函数索引不适用`的常见场景：1. 函数 / 表达式结果高度离散；2.函数 / 表达式结果低基数 3. 频繁更新的字段 4. 函数包含不确定 / 动态值  5. 小表，数据量极小  6. 函数 / 表达式复杂且计算成本高（是！）

#### PostGreSQL的`部分索引是只对一个表中的部分行进行的索引`，是由一个条件表达式把这部分行筛选出来（该条件表达式被称为部分索引的谓词），只对筛选出来的数据创建索引（是！）

#### PostgreSQL支持带任意谓词的部分索引，但是
`只有在系统能够识别出该查询的WHERE条件简单地包含了该索引的谓词时，这个部分索引才能用于该查询`。PostgreSQL不能完全识别那些形式不同但数学上意义相等的谓词（是！）

#### PG支持设置`部分唯一索引`，即全局不唯一，但是筛选条件下唯一（是！）

#### PostgreSQL支持在任意数据类型上建立BTree索引，但是BTree索引只支持范围谓词(<,=, >)，HASH索引仅支持相等查询，而GiST的索引还能支持包含(@>)、重叠(&&)等复杂运算（是！）

#### 在 PostgreSQL 中，不指定索引类型时，默认创建的是 B 树（B-tree）索引（严格来说是 B+ 树的变体，PostgreSQL 官方文档统一称 B-tree）（是！）

#### PostgreSQL 的 CREATE INDEX 语法中，若
`省略 USING` 子句指定索引类型，数据库会根据索引字段的数据类型和使用场*默认选择 B-tree 索引（是！）

#### PostgreSQL `显式指定创建 B 树（B+ 树）索引，需通过 USING btree` 子句明确声明，这是最规范的写法(是！)

#### GiST的索引的创建

#### `SP-GiST即空间分区GiST索引`（通常用于多重空间），它主要是通过一些新的索引算法提高GiST索引在某种情况下的性能（是！）

#### SP-GiST索引的创建

#### GIN索引是即广义倒排索引。通常GIN索引作为全文检索使用，即在文章中搜索指定的词。GIN索引中存储了一系列“key，位置列表”对，位置列表中存储了包含此key值的行的列表。同一行的rowid会出现在多个位置列表中。

#### GIN索引创建

#### GIN索引可以结合 tsvector 类型使用，加快全文检索（是！）

#### GIN索引对于插入更新操作效率比较低，如果要向一张表中插入大量数据，最好先把GIN索引删除，然后插入数据，最后再把GIN索引重新建起来，把maintenance_work_mem参数调大，可以更快地完成GIN索引的创建工作。（是）

#### BRIN索引(`todo！`)

## 全文检索

#### PostgreSQL内置了全文检索功能，但内置的功能只能检索英文。当然，配置一些插件如 zhparser 也可以对中文进行全文检索(是)

#### 安装 zhparser 插件实现中文检索（`todo!`）

#### 安装 pg_jieba 分词插件 实现中文检索（`todo!`）

#### g_jieba 对中文的支持显著优于 zhparser—— 尤其是在分词精度、功能丰富度、自定义能力等核心维度，pg_jieba 是 PostgreSQL 生态中目前最优的中文分词扩展之一（是！）

#### PostgreSQL把长文本分解成很多token的集合，这个token集合叫tsvector，代表了文档，搜索实际上是在token集合中进行的

#### `to_tsvector `是 PostgreSQL 中核心的全文检索函数，用于将普通文本（text 类型）转换为优化后的 tsvector 类型数据（是！）

#### PostgreSQL增加了一个检索条件的类型“tsquery”，tsquery是一个由简单逻辑运行符号组成的字符串，PostgreSQL也提供了函数“to_tsquery”来实现这个转换（是！）

#### PostgreSQL全文检索的搜索过程实际上使用一个tsvector和tsquery进行匹配，tsvector代表了文档，而tsquery代表了检索条件，匹配的运算符是"@@"（是！）

#### 基于tsvector做全文检索时一般都要结合GIN索引加快扫描（是！）

## 并行查询

#### PostgreSQL并行查询相关的配置参数

#### PostgreSQL支持的并行操作

## 规则系统

#### PostgreSQL的视图是通过SELECT规则来实现的(是！)

#### SELECT规则的后续动作只能是INSTEAD SELECT，即只能用另一个SELECT语句取代（是！）

#### SELECT规则的名称只能是“_RETURN”

#### 创建规则的 语法

#### 规则(RULE)是从属于表或视图的。如果一张表属于一个用户，则这张表上的所有规则都是属于这个用户的。在规则系统中检测权限时，是对规则的属主进行权限检查，而不是执行规则的用户(是)

#### 触发器能做的很多事情使用PostgreSQL的规则系统也可以完成，使用哪种方法取决于具体的应用场景。规则系统是通过查询重写来实现的，而触发器通常是为每个行都触发执行一次，所以对于批量操作，使用规则可能会生成更好的执行计划，从而效率更高一些。是）

#### 触发器和规则选型和适用（`todo！`）

## PG的MVCC